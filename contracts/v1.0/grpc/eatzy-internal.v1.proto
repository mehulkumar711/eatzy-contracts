// Use `buf` CLI to generate stubs
syntax = "proto3";
package eatzy_internal.v1;

// Import for standard error status (will be used by services)
import "google/rpc/status.proto";

// -----------------------------------------------------------------
// Delivery Service (Go)
// -----------------------------------------------------------------
service DeliveryService {
  // Finds the best rider for a new order.
  // Implementers MUST enforce a short deadline (e.g., 5s).
  // Return DEADLINE_EXCEEDED if timeout occurs.
  rpc AssignRiderToOrder (AssignRiderRequest) returns (AssignRiderResponse);
}

message AssignRiderRequest {
  string order_id = 1;
  string vendor_id = 2;
  double vendor_lat = 3;
  double vendor_lng = 4;
}

message AssignRiderResponse {
  string order_id = 1;
  string rider_id = 2;
  int32 estimated_pickup_time_seconds = 3;
}

// -----------------------------------------------------------------
// Payment Service (NestJS)
// -----------------------------------------------------------------
service PaymentService {
  // Creates a payment intent (e.g., in Razorpay).
  // Implementers MUST use a deadline (e.g., 10s).
  // Return DEADLINE_EXCEEDED if 3rd party (Razorpay) times out.
  rpc CreatePaymentIntent (CreatePaymentIntentRequest) returns (CreatePaymentIntentResponse);
  
  // Triggers a refund for a failed/cancelled order.
  rpc IssueRefund (IssueRefundRequest) returns (IssueRefundResponse);
}

message CreatePaymentIntentRequest {
  string order_id = 1;
  string user_id = 2;
  int64 amount_paise = 3; // Use integers for currency
  string currency = 4; // e.g., "INR"
}

message CreatePaymentIntentResponse {
  string payment_intent_id = 1;
  string client_secret = 2;
  string status = 3; // e.g., "requires_payment"
}

message IssueRefundRequest {
  string payment_intent_id = 1;
  int64 amount_paise = 2;
}

message IssueRefundResponse {
  string refund_id = 1;
  string status = 2; // e.g., "processing"
}